# 核心模块

该目录包含应用程序的业务逻辑层和数据处理层组件。

## 文件说明

- `controller.py`: 应用程序控制器，通过**信号与槽机制**协调UI和业务逻辑。
- `image_processor.py`: 图像处理功能实现，包含裂缝检测与过滤算法。
- `analysis_stages.py`: 分析阶段枚举定义。
- `unit_converter.py`: 像素和物理单位转换工具。

## 图像处理流程

图像处理遵循以下步骤：
1.  加载原始图像并提取DPI信息。
2.  转换为灰度图像。
3.  应用阈值分割获取二值图像。
4.  应用形态学操作（如开/闭运算）来优化裂缝形态。
5.  检测所有潜在的裂缝轮廓。
6.  **根据用户设定的物理参数（最小长度、最小长宽比）对轮廓进行过滤。**
7.  **(可选) 对接近的裂缝进行智能合并。**
8.  计算最终裂缝的物理属性（长度、面积等）并可视化。

## 控制器设计

`Controller`类是本模块的中心，它负责：
- **状态管理**: 保存当前加载的图像、DPI信息以及所有分析阶段的结果。
- **流程驱动**: 响应UI事件（如"开始分析"按钮点击、参数滑块调整），并调用`ImageProcessor`中的函数执行相应操作。
- **链式更新**: 当一个处理参数（如阈值）改变时，自动触发后续依赖阶段（如形态学处理）的重新计算和预览更新。
- **结果分发**: 通过Qt信号 (`analysis_complete`, `preview_stage_updated`) 将处理结果或错误信息传递回UI层进行展示。
- **单位转换**: 利用`UnitConverter`将像素单位的计算结果转换为物理单位（毫米）。

## 分析阶段

系统定义了以下处理阶段（在`analysis_stages.py`中）：
- `ORIGINAL`: 原始图像
- `GRAYSCALE`: 灰度图像
- `THRESHOLD`: 阈值分割
- `MORPHOLOGY`: 形态学处理
- `DETECTION`: 最终检测和可视化的裂缝结果
- `MEASUREMENT`: 量化的物理测量数据

每个阶段的处理结果都保存在控制器的`analysis_results`字典中，以便在UI层展示和后续处理。 